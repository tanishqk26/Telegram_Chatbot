

# Solace Bot (The Telegram Bot)  

This is a Telegram bot built using Python, leveraging the `python-telegram-bot` library, the `Gemini API` for image and text generation, and the `Google Custom Search API` for web search integration. It stores user data and chat history in a MongoDB database and processes image/PDF files for description generation.

## Features:
1. **User Registration**: The bot registers users with their Telegram usernames and phone numbers.
2. **Image Handling**: The bot can process images sent by users and generate descriptive text using the Gemini API.
3. **PDF Handling**: The bot can process PDF files by converting them into images and generating descriptions for the first page.
4. **Web Search**: The bot can perform web searches using the Google Custom Search API and return the top results.
5. **MongoDB Storage**: User data, chat history, web search history, and file metadata are stored in MongoDB for tracking and analytics.
6. **Real-Time Communication**: The bot can send real-time responses to users based on the input they provide (text, images, or PDFs).

## Requirements:
- Python 3.7 or higher
- Install the required libraries by running the following:
  ```bash
  pip install python-telegram-bot pymongo google-generativeai python-dotenv pdf2image requests Pillow crewai beautifulsoup4
  ```
  
### MongoDB Setup:
MongoDB is used to store the following data:
- **users**: Stores user details like `chat_id`, `first_name`, `username`, and `phone_number`.
- **chat_history**: Stores messages exchanged between users and the bot.
- **file_metadata**: Stores metadata about uploaded files (e.g., images, PDFs) and their generated descriptions.
- **web_search_history**: Stores web search queries and the corresponding results.

### Telegram Bot:
To create a new bot:
1. Open the Telegram app.
2. Search for `BotFather` and follow the instructions to create a new bot and get your bot token.
3. Set up your bot with the provided `BOT_TOKEN` in the `.env` file.

## Functionality:

### 1. **/start Command**:
   - Upon starting the bot, users are registered if they haven't done so already.
   - The bot asks the user to share their phone number (optional) using a contact-sharing button.

### 2. **/websearch Command**:
   - Users can search the web by using the `/websearch` command followed by a query.
   - The bot uses the Google Custom Search API to fetch search results and returns the top 3 results to the user.
   - The query and results are stored in MongoDB.

### 3. **Image Handling**:
   - If a user sends an image, the bot processes the image and generates a description using the Gemini API.
   - The image description is sent back to the user and the metadata (image file and description) is saved in MongoDB.

### 4. **PDF Handling**:
   - If a user sends a PDF document, the bot converts the PDF to images (one for each page).
   - The bot generates a description of the first page using the Gemini API.
   - The PDF file metadata and description are saved in MongoDB.

### 5. **Text Messages**:
   - If a user sends a text message, the bot responds by generating content based on the message using the Gemini API.
   - The bot replies with the generated content and logs the chat history in MongoDB.

### 6. **File Metadata Storage**:
   - When an image or PDF file is uploaded, the bot stores the file metadata (e.g., file type, name, description) in MongoDB.
   - This allows tracking of user activity and content.

## Example Workflow:

1. **Start a conversation**:
   - User: `/start`
   - Bot: "Welcome! Please share your phone number."

2. **User provides a contact**:
   - User: Shares phone number
   - Bot: "Thank you! Your phone number has been saved."

3. **Web search query**:
   - User: `/websearch Python programming`
   - Bot: Returns top 3 search results from Google Custom Search API.

4. **Send an image**:
   - User: Sends a photo.
   - Bot: Returns a description of the image generated by Gemini API.

5. **Send a PDF**:
   - User: Sends a PDF document.
   - Bot: Converts the first page to an image, generates a description, and replies with the description.

6. **Text chat**:
   - User: Sends a message like "Tell me a joke."
   - Bot: Responds with a generated joke.

## Contributing:
If you'd like to contribute to this project, feel free to fork the repository, create a branch, and submit a pull request. Please make sure to follow the coding style and ensure that the code runs without errors.

